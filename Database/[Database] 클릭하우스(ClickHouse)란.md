# 클릭하우스(Click House)란?
- OLAP(Online Analytical Processing) 전용 데이터베이스

- 쉽게 말해 "빅데이터 분석을 위해 특별히 설계된 데이터베이스"라고 생각하면 편하다.

- 일반 DB와 다르게 컬럼지향 DBMS로 아래 이미지에서 볼 수 있듯이 1개의 열에 하나의 데이터 정보가 담겨져 있다.
<img width="795" height="339" alt="image" src="https://github.com/user-attachments/assets/f0e60647-75d9-4553-a428-7737f431dbb3" />
<br>
<br>

![img](https://github.com/user-attachments/assets/f96cfb11-cc85-4f52-ac22-242f44d9e32f)
> 관계형 데이터 베이스 동작 방식 (Oracle, MySQL 등 ...)
<br>

![img (1)](https://github.com/user-attachments/assets/e5563e2d-0ce8-4f01-9dce-efcca6dc4966)
> 컬럼형 데이터베이스 동작 방식 (ClickHouse)
<br>
<hr>
<br>

## ✔️ 핵심 특징
### 매우 빠른 속도
- 일반적인 SQL 쿼리보다 100-1000배 빠른 성능

- 반응형 웹 서비스에서는 보통 밀리초(ms) 단위로 응답하는데, 클릭하우스는 초 단위로 수십억 건의 데이터 처리 가능
<br>
<br>

### 컬럼형 데이터 저장
```
일반 DB (행 기반):
ID | 이름    | 나이 | 부서
1  | 홍길동   | 30  | 개발팀
2  | 김철수   | 25  | 마케팅팀

클릭하우스 (컬럼 기반):
ID 컬럼:     [1, 2, 3, ...]
이름 컬럼:    [홍길동, 김철수, ...]
나이 컬럼:    [30, 25, 28, ...]
```
> 분석할 때 필요한 컬럼만 읽음
<br>
<br>

### 압축률이 뛰어남
- 텍스트 데이터도 10:1 - 20:1로 압축

- 저장 공간을 크게 절약
<br>
<hr>
<br>

## ✔️ 언제 사용해야 할까?
- ✅ 클릭하우스가 좋은 경우
  - 대시보드, 리포트: 실시간 분석이 필요한 BI 도구
  - 로그 분석: 웹사이트 방문자, 앱 사용 패턴 분석
  - 시간순 데이터: IoT 센서, 주식 데이터 등 시계열 데이터
  - 집계 쿼리: COUNT, SUM, AVG 등 통계 작업
<br>

- ❌ 클릭하우스가 부적합한 경우
  - 온라인 트랜잭션(OLTP): 사용자 가입, 주문 입력 등 실시간 CRUD
  - 복잡한 관계형 조인: 여러 테이블 간 복잡한 관계
  - 작은 데이터량: 굳이 클릭하우스 쓸 필요 없음
<br>
<hr>
<br>

## ✔️ 관계형 DB와 클릭하우스의 핵심 차이점
- 클릭하우스가 컬럼 기반으로 인하여 속도가 빠르다고 하는데, 도저히 이해가 되지 않을 것이다.

- 이에 대한 핵심 차이점은 앞서 말한대로 저장 방식(행 기반, 컬럼 기반)에 있는 것이고, 아래 설명을 확인해보자.

### 관계형 DB (행 기반 저장)
```
디스크에 실제로 저장되는 모습:
[1, 홍길동, 30, 개발팀] [2, 김철수, 25, 마케팅팀] [3, 이영희, 28, 개발팀] ...

파일 구조:
Row 1: [1, 홍길동, 30, 개발팀]
Row 2: [2, 김철수, 25, 마케팅팀]  
Row 3: [3, 이영희, 28, 개발팀]
```
<br>
<br>

### 클릭하우스 (컬럼 기반 저장)
```
디스크에 실제로 저장되는 모습:
ID.bin:     [1, 2, 3, 4, 5, ...]
이름.bin:   [홍길동, 김철수, 이영희, 박민수, ...]
나이.bin:   [30, 25, 28, 33, ...]
부서.bin:   [개발팀, 마케팅팀, 개발팀, ...]
```
<br>
<br>

### 실제 성능 차이 예시
- 나이 컬럼만 SELECT 하는 경우
```sql
SELECT AVG(age) FROM users WHERE department = '개발팀';
```
<br>

- 관계형 DB:
  - 디스크에서 **모든 행**을 읽어야 함(ID, 이름, 나이, 부서 모두)
  - 100만 행이면 100만 개의 완전한 레코드를 메모리로 로드
  - 그 다음에 "나이"와 "부서" 정보만 추출해서 계산
<br>

- 클릭하우스:
  - 디스크에서 **나이.bin**과 **부서.bin** 파일만 읽음
  - 다른 컬럼(ID, 이름)은 아예 읽지 않음
  - 메모리 사용량이 1/4로 줄어듦
<br>

### 시각적 비교
```
// 관계형 DB가 읽는 데이터 (100만 행 예시)
Row 1: [1, 홍길동, 30, 개발팀]     ← 모든 컬럼을 읽음
Row 2: [2, 김철수, 25, 마케팅팀]   ← 모든 컬럼을 읽음  
Row 3: [3, 이영희, 28, 개발팀]    ← 모든 컬럼을 읽음
...

// 클릭하우스가 읽는 데이터
나이 데이터만: [30, 25, 28, 33, 29, ...]
부서 데이터만: [개발팀, 마케팅팀, 개발팀, ...]
```
<br>
<hr>
<br>

## ✔️ 정리
- 관계형 DB의 WHERE절이 "필요한 데이터만 가져온다"는 것은 로직적으로 맞지만, 디스크 레벨에서는 여전히 전체 행을 읽어야 한다.

- 클릭하우스는 물리적으로 필요한 컬럼 파일만 디스크에서 읽기 때문에:
  - I/O 시간 단축
  - 메모리 사용량 감소
  - 압축률 향상
  - CPU 캐시 효율성 증가
<br>

- 즉, 필요한 컬럼만 읽어 최대한의 성능을 뽑아내는 것이 클릭하우스의 특징이다.
<br>
<hr>
<br>

**Reference**<br>

[neunghi : ClickHouse란](https://velog.io/@baeyuna97/ClickHouse%EB%9E%80)<br>
[책만펴면감성폭발 : Click House 개요](https://alwayscalm.tistory.com/2)
